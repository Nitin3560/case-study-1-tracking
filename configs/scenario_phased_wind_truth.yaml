sim:
  drone_model: "cf2x"
  physics: "pyb"
  gui: false

  # Physics & control
  freq_hz: 240
  ctrl_hz: 48
  duration_s: 40.0
  num_drones: 4
  seed: 1
  debug_obs: false

  # Actuator limits (used for saturation-aware PID)
  rpm_min: 0
  rpm_max: 18000


trajectory:
  type: "circle"
  radius_m: 8.0
  period_s: 18.0
  altitude_m: 2.0
  center_xy: [0.0, 0.0]


formation:
  type: "square"
  spacing_m: 2.0


disturbance:
  wind:
    mode: "phased"
    phases:
    - t0_s: 0.0
      t1_s: 10.0
      constant_force_n: [0.03, 0.0, 0.0]
      gust_force_n_max: 0.06
      gust_interval_s: [0.3, 0.6]
      gust_duration_s: [0.4, 0.8]

    - t0_s: 10.0
      t1_s: 25.0
      constant_force_n: [0.06, 0.00, 0.0]
      gust_force_n_max: 0.125
      gust_interval_s: [1.0, 2.5]
      gust_duration_s: [0.6, 1.4]

    - t0_s: 25.0
      t1_s: 40.0
      constant_force_n: [0.04, 0.00, 0.0]
      gust_force_n_max: 0.10
      gust_interval_s: [2.0, 4.0]
      gust_duration_s: [0.3, 0.8]

  gps_drift:
    enabled: True


metrics:
  steady_state_after_s: 25.0


controllers:

  sensing:
    openloop: "gps"
    pid: "gps"
    agentic: "gps"


  pid:
    kp: 0.9
    kd: 0.35
    ki: 0.05
    v_max: 5.5

    # Integrator hysteresis gates (matches pid_core.py)
    int_gate_on_err_m: 2.0
    int_gate_off_err_m: 3.0
    int_gate_on_vel_mps: 4.0
    int_gate_off_vel_mps: 5.0

    int_leak: 0.995
    int_clamp: 1.5

    # D-term filtering (matches pid_core.py)
    d_mode: "vel"
    d_tau_s: 0.05

    # If baseline PID does NOT pass sat_frac -> set false for honesty/fairness
    int_sat_hold: false
    int_sat_leak: 1.0


  agentic:
    # Time horizon: low-bandwidth supervisory layer
    lookahead_s: 0.8

    # Deadband before intervention (important for fairness)
    error_thresh_m: 1.8

    # Strict authority limits
    max_ref_shift_m: 0.20

    # Make agentic strictly memoryless (feedforward-only)
    authority_alpha: 0.0
    authority_ramp_mult: 2.5

    # Saturation detection tolerance (keep numeric, not quoted)
    rpm_eps: 1e-3